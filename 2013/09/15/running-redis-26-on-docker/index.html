<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=UTF-8" http-equiv="content-type" /><meta name="description" /><meta name="keywords" /><meta content="Chris Smith" name="author" /><meta content="width=device-width, initial-scale=1.0" name="viewport" /><link href="/images/favicon.ico" rel="icon" type="image/x-icon" /><link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" /><link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet" type="text/css" /><link href="//fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans" rel="stylesheet" type="text/css" /><link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" /><link href="/css/crsmithdev.css" rel="stylesheet" type="text/css" /><title>Running Redis 2.6 on Docker</title></head><body><div class="header"><nav class="navbar navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button class="navbar-toggle" data-target=".navbar-ex1-collapse" data-toggle="collapse" type="button"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/index.html">Chris Smith</a></div><div class="collapse navbar-collapse navbar-ex1-collapse"><ul class="nav navbar-nav"><li><a href="/blog.html">Blog</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/about.html">About</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a class="icon-header" href="http://github.com/crsmithdev"><i class="icon-github icon-2x"></i></a><li><a class="icon-header" href="http://twitter.com/crsmithdev"><i class="icon-twitter icon-2x"></i></a><li><a class="icon-header" href="http://www.linkedin.com/in/crsmithdev"><i class="icon-linkedin icon-2x"></i></a></li></li></li></ul></div></div></nav></div><div class="content"><div class="container"><div class="row"><div class="col-md-12"><h2>Running Redis 2.6 on Docker</h2><h3>Docker</h3><p>With the end of my free tier eligibility looming on AWS, I took advantage of the <a href="http://developer.rackspace.com/devtrial/">Rackspace developer discount</a> and set up a new account and personal server this weekend. One of the technologies I've been most interested in recently is <a href="http://www.docker.io">Docker</a>, a container engine for Linux which aims to be the intermodal shipping container for applications and their dependencies. A brand-new box seemed like the perfect time to dig in to it.</p><p>To get a sense of what Docker is and how it works, I'd recommend going through the <a href="http://www.docker.io/gettingstarted/">getting started</a> tutorial as well as some of the examples in the <a href="http://docs.docker.io/en/latest/">documentation</a>. However, here's a very brief rundown:</p>
<ul>
  <li>Docker uses <a href="https://en.wikipedia.org/wiki/LXC">LXC</a> and a <a href="https://en.wikipedia.org/wiki/Union_filesystem">union file system</a> (<a href="https://en.wikipedia.org/wiki/Aufs">AUFS</a>) to run isolated containers (<strong>not</strong> VMs).</li>
  <li>Software and its dependencies are packaged into an <strong>image</strong>.</li>
  <li>Images are immutable and stateless.</li>
  <li>Images can be committed in layers to form more complex images.</li>
  <li>An image running a process is called a <strong>container</strong>, which is stateful.</li>
  <li>A container exists as running or stopped, and can be run interactively or in the background.</li>
  <li>Images are lightweight, perhaps 100Mb for a Redis server running on Ubuntu.</li>
  <li>Containers are not virtual machines, so they are lightening-fast to boot and lightweight on resources.</li>
</ul><p>One of the documentation examples describes setting up a <a href="http://redis.io">Redis</a> service. Following the example was straightforward, but I felt it was missing two things when I was finished. First, it uses Redis 2.4, which is already quite out of date (as of this writing, Redis 2.8 is nearing release). And second, it still required some parameters passed in order to actually launch the container, including the <code>redis-server</code> path and port, which seemed unnecessary. Fortunately, I found it was easy to address both of these, and was a great introduction to using Docker. </p><h3>Installing Redis 2.6</h3><p>The first thing to do is start a container from a base image, in this case the <code>ubuntu</code> image pulled during setup:</p>
<pre><code>docker run -i -t ubuntu /bin/bash
</code></pre><p>This results in a root shell on a new, running Ubuntu container. A few things will be needed in order to download, build and test Redis:</p>
<pre><code>apt-get install wget build-essential tcl8.5
</code></pre><p>To install Redis 2.6, it's necessary to build it from source: </p>
<pre><code>wget get http://download.redis.io/releases/redis-2.6.16.tar.gz
tar xvf redis-2.6.16.tar.gz
cd redis-2.6.16
</code></pre><p>Build it, run some tests and install once completed:</p>
<pre><code>make
make test
make install
</code></pre><p>Lastly, move the config file to a more standard location:</p>
<pre><code>mkdir /etc/redis
mv redis.conf /etc/redis/redis.conf
</code></pre><p>Verify the server is working by running the following:</p>
<pre><code>redis-server /etc/redis/redis.conf
</code></pre><h3>Adding run arguments to the image</h3><p>In the example, the resulting container is commited to an image and run like so:</p>
<pre><code>sudo docker commit &lt;container_id&gt; crsmithdev/redis
sudo docker run -d -p 6379 crsmithdev/redis /usr/bin/redis-server
</code></pre><p>However, it makes more sense to me that it <strong>always</strong> runs on port 6379, and <code>redis-server</code> is the only command this container should ever be running. Here's an alternate way to commit the container that addresses both these issues:</p>
<pre><code>sudo docker commit -run=&#39;{&quot;Cmd&quot;:[&quot;/usr/local/bin/redis-server&quot;, &quot;/etc/redis/redis.conf&quot;] \
    &quot;PortSpecs&quot;:[&quot;6379&quot;]}&#39; &lt;container_id&gt; crsmithdev/redis2.6
</code></pre><p>With that, you can run the container with no arguments:</p>
<pre><code>sudo docker run -d crsmithdev/redis2.6
</code></pre><p>Then, connect with <code>redis-cli</code> and verify that it's running correctly.</p><h3>Fin!</h3><p>And that's it. This image can then be downloaded and started, producing a running, fully-functional Redis server in literally a few seconds.</p><p>You can grab my image <a href="https://index.docker.io/u/crsmithdev/redis2.6/">here</a>.</p><div class="shares"><a class="twitter-share-button" data-via="crsmithdev" href="https://twitter.com/share">Tweet</a></div><br /><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'crsmithdev';var disqus_identifier = 'http://crsmithdev.com' + window.location.pathname;var disqus_url = disqus_identifier;(function() {var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><script type="text/javascript">!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></div></div><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.0.0-rc2/js/bootstrap.min.js"></script><script src="//google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script><script src="//google-code-prettify.googlecode.com/svn/trunk/src/lang-clj.js"></script><script src="/js/crsmithdev.js"></script><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-40826256-2', 'crsmithdev.com');ga('send', 'pageview');</script></div></div><div class="footer"><div class="container"><div class="row"><div class="col-md-12"><p>Built with <a href="http://getbootstrap.com/">Bootstrap</a> and <a ref="https://github.com/nakkaya/static">Static</a><br />&copy; 2013 <a href="http://crsmithdev.com">Chris Smith</a></p></div></div></div></div></body></html>